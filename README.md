# crypto-trader-bot


# Crypto Trading Bot - Prompt

## 目的
暗号通貨の自動取得・分析・取引を行うボットを開発し、AI を活用したトレード戦略を構築する。
- **使用する取引所**: CoinCheck(BTC/JPY) , Binance
- **AIエンジン**: 未定
- **取引ロジック**: テクニカル指標 + AI分析

## 技術スタック
- **開発言語**_: Python
- **フロントエンド**: Streamlit
- **バックエンド**: FastAPI、Uvicorn
- **インフラ環境**: AWS Lambda / S3, Docker(frontend/backend)
- **開発環境**: Mac, VSCode, Docker


---
## 構成

### 1. 基本インターフェース作成
- データ取得・取引実行の基本機能を実装
  - 為替レート取得（Yahoo Finance）
    売買取引市場はCoinCheckを対象とするため、対象通貨はJPY限定となるためUSDTとの計算が必要。
  - [CoinCheck API ドキュメント](https://coincheck.com/ja/documents/exchange/api)

### モデルパイプライン
+ CryptoTrainingDataset
  - Binance API からohlcvデータ取得し機械学習用のデータセットを作成
+ FeatureDatasetModel
  - 説明変数（Features）
    - テクニカル指標：SMA、ボリンジャーバンド、RSI など
    - トレンド検知：ボックス相場からのブレイクアウト、ゴールデンクロス／デッドクロス
    - 出来高指標：直近の出来高急増日からの経過日数
    - 時系列特徴量：過去10〜15日のラグデータをまとめて追加
    - データスケーリング：MinMaxScaler を適用
  - 目的変数（Target）
    - 「**30日以内に目標利幅（年利30%換算の収益率）を達成できるか**」を表すトレード成功フラグ
    - シグナル定義
      - 買いシグナル:
        30日以内に目標利幅を達成すると予測された場合
      - 売りシグナル:
        1. 目標利幅に到達した場合（利確）
        1. 最大保有期間（30日）を超過した場合（時間切れ）
        1. 許容下落幅に達した場合（損切り）
+ EnsembleModel
  - 学習済みモデルを保存
  - 自動チューニング（ハイパーパラメータ最適化)
  - 回帰分析モデルなどいくつかのモデルをアンサンブルして予測を実行し、次の取引の判断に利用
+ Evaluation
  - モデルの検証
  - 過去データを使って予測の精度を評価
  - MSE（平均二乗誤差）や RMSE（ルート平均二乗誤差）で誤差を計測
  - 学習データとテストデータを分割し、オーバーフィッティングを防ぐ
  - 検証結果を記録して、今後の改善に役立てる

### 2. Bot（Python + AWS）の基本構成作成
- Python によるデータ処理と AWS を活用した実行環境構築
- AWS Lambda を利用した定期実行
- AWS SAM によるインフラ管理
- Docker での開発環境構築
- 定期学習

### 3. Slack 通知の Webhook 設定
- 取引結果やアラートを Slack に通知
- 成行売買と指値売買をハイブリッドで注文とキャンセルを可能とする。
- エラーハンドリングも含めた実装

### 4. AWS Lambda 作成
- CoinCheck API からのデータ取得
- S3 への保存と履歴管理
- 定期実行設定（CloudWatch Events）

### 5. AI 分析（AWS Bedrock）
- **価格予測**（短期・中期）
- **システムトレード**（機械的な売買ルール）
- **未来の特徴量の回帰分析予測**
- **トレンド判定**（上昇 or 下降）
- **ボラティリティの検出**（急騰 or 急落の予測）
- **ニュースやセンチメント分析を加えた戦略**
  - VIX が 30 以上 & S&P500 が下落トレンド → BTC のショート戦略
  - BTC の取引所流入量が急増 & オープンインタレストが高い → 高ボラティリティに備えてポジション縮小
  - ステーブルコイン供給量増加 & BTC ドミナンス低下 → アルトコインの買い戦略
  - 先物市場を元に購入戦略を立てる
  - 米国カレンダーなどの時事情報と組み合わせる

### 6. 購入データの保存と分析
- **取引結果の記録**（勝率・利益率の計算）
- **多軸での分析**（VIT, GOLD など）
- **過去データの収集・バックテスト**（CoinCheck の過去データを S3 や DynamoDB に保存し、分析）

### 7. セキュリティと API 管理
- **API エラー時のリトライ戦略**（レートリミット超過、ネットワークエラー対応）
- **価格変動が激しい時の対応**
- **Bot の取引量を調整し、市場への影響を最小化**

### 8. 対象通貨の選択
- CoinCheck で **流動性の高い通貨ペア** を選択
- BTC/USDT, ETH/USDT, アルトコイン？

### 9. アルゴリズム選定
- **トレード戦略の検討**
  - **スキャルピング**（短期売買）
  - **デイトレード**（1日内完結）
  - **スイングトレード**（数日～数週間）
  - **レバレッジと指値の設定**

### 10. リスク管理とロスカットの設定
- 取引ごとの **最大損失額**（例: 5% 以下）
- **トレーリングストップ** の活用

### 11. 機械学習の活用と数値予測
- **ランダムフォレスト, LSTM（長短期記憶ネットワーク）, XGBoost などの活用**
- **AI の予測とテクニカル指標（移動平均線、RSI、ボリンジャーバンド）を組み合わせる**

## 実装スケジュール
- **フェーズ 1:** CoinCheck API の基本機能 & データ保存の実装
- **フェーズ 2:** AWS Lambda の設定 & Slack 通知の実装
- **フェーズ 3:** AI 予測の導入 & システムトレードの実装
- **フェーズ 4:** リスク管理 & バックテスト環境の構築

## 目標
- **収益性の高い自動売買 Bot の構築**
- **AI を活用した精度の高いトレード戦略の実装**
- **安全かつ拡張可能なインフラの構築**

---
# スイングトレード戦略

## 概要

このプロジェクトは、**テクニカル分析** と **ファンダメンタルズ分析** を組み合わせた **スイングトレード戦略** を実装しています。通常、**数日～数週間** の取引期間を想定し、以下の手法を活用します。

- **トレンドフォロー（順張り）**: 移動平均線、RSI、MACD を活用し、トレンドの方向に沿った取引を行う。
- **レンジトレード**: ボリンジャーバンドやサポート・レジスタンスを活用し、価格の範囲内で売買。
- **ブレイクアウト戦略**: 一定の価格レンジを突破した際にエントリー。ATRや出来高分析を活用。
- **ファンダメンタルズ分析**: 経済指標、オンチェーンデータ、市場心理を考慮してトレードを最適化。
- **機械学習による波の予測**: 価格の波の頂点と底を予測し、最適なエントリー・エグジットを決定。

---

## テクニカル分析

### 1. **トレンドフォロー戦略**

- **SMA（単純移動平均線）** と **EMA（指数移動平均線）** でトレンドを判断。
- **RSI（相対力指数）** で買われすぎ・売られすぎを判断。
- **MACD（移動平均収束拡散）** でトレンドの強さを確認。

### 2. **レンジトレード戦略**

- **サポート・レジスタンス** を特定し、価格の範囲内で売買。
- **ボリンジャーバンド** を活用し、過度な価格変動を識別。
- **RSI** を使って、買われすぎ・売られすぎの判断を行う。

### 3. **ブレイクアウト戦略**

- **価格の停滞（コンソリデーション）** を検出し、ブレイクアウトを狙う。
- **ATR（平均真実幅）** を活用し、ボラティリティを考慮。
- **出来高の急増** を確認し、ブレイクの強さを判断。

---

## ファンダメンタルズ分析

### 1. **オンチェーンデータ分析**

- **ハッシュレート**: ネットワークの安全性とマイナーの信頼度を測る。
- **アクティブアドレス数**: 実際に取引されているウォレットの数。
- **取引所へのBTC流入量**: 売却圧力の指標。増加すると価格下落の可能性。
- **取引所からのBTC流出量**: 長期保有の兆候。

### 2. **マクロ経済要因**

- **米国金利**: 金利上昇時はBTC売却圧力が強まりやすい。
- **インフレ率（CPI指数）**: インフレが高いとBTCがインフレヘッジ資産として買われる傾向。
- **S&P500との相関**: 株式市場の動向に影響を受ける。
- **ドル指数（DXY）**: 米ドルが強いとBTC価格は下落しやすい。

### 3. **市場心理分析**

- **Fear & Greed Index（恐怖と欲望指数）**: 極端な恐怖は買い時、極端な欲望は売り時のサイン。
- **資金の流入・流出**: 取引所の資金流入が増えると売り圧力が高まる。
- **クジラの動向**: 大口投資家の動きをチェック。

---

## 機械学習による価格予測

- 価格の単純な将来値ではなく、**次の波の頂点と底を予測**
- 短期的な波の動きを捉え、最適なエントリー・エグジットを決定
- ボラティリティの高いタイミングを検出し、適切なポジション調整を実施

---

## トレード実行ロジック

1. **テクニカル指標の分析**
   - トレンド、レンジ、ブレイクアウトのいずれかを判断。
2. **ファンダメンタルズの考慮**
   - マクロ経済、オンチェーンデータ、市場心理を確認。
3. **機械学習の予測を統合**
   - 波の頂点と底を予測し、適切なタイミングでエントリー・エグジットを決定。
4. **売買の意思決定**
   - 指標の合流点を見つけてエントリー。
   - ストップロス（損切り）とテイクプロフィット（利益確定）を設定。
5. **ポジションの監視と調整**
   - 市場の変化に応じて適切に対応。

---

## 今後の改善点

- **機械学習モデルの精度向上（波の予測最適化）**
- **リアルタイムのAPIデータ取得を統合**
- **ボラティリティに応じたリスク管理の最適化**


# セットアップ

### Python初期設定
```
python3.11 -m venv venv311
source venv311/bin/activate
pip install --upgrade pip
pip install -U -r frontend/requirements.txt
pip install -U -r backend/requirements.txt
```

### sam初期設定
- S3 Bucket作成
```
sam deploy
sam deploy --guided
```

### Docker
```
docker-compose build && docker-compose up -d
docker-compose exec backend bash
docker-compose logs -f backend
docker-compose run -e TASK_MODE=auto_trade -e APP_ENV=production backend
```

### DotEnv
```
S3_BUCKET=

BYBIT_API_KEY=KE***********
BYBIT_API_SECRET=****************
BYBIT_BASE_URL=https://api-testnet.bybit.com
```

### ECS
```
aws ecs describe-clusters --clusters $ECS_CLUSTER
aws ecs describe-services --cluster $ECS_CLUSTER --services $ECS_SERVICE
aws ecs list-tasks --cluster $ECS_CLUSTER
```
### 作業メモ
```
pip3 freeze > requirements.txt
aws s3 ls s3://crypto-trader-bot/crypto_data/
```

